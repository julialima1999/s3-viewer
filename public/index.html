<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leitura do S3</title>
  <link rel="stylesheet" href="/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <h1>ðŸ“¦ Dados do S3</h1>

  <div id="charts" style="display:none;">
    <canvas id="chart1" width="400" height="200"></canvas>
  </div>

  <h3 class="title">ðŸ“œ Dados brutos:</h3>
  <pre id="raw-data">Carregando...</pre>

  <script>
    async function carregarDados() {
      const caminho = window.location.pathname;

      // Detecta se a URL Ã© /ver/arquivo ou /dados/arquivo
      const isVer = caminho.includes("/ver/");
      const isDados = caminho.includes("/dados/");

      const arquivo = caminho.split(isVer ? "/ver/" : "/dados/")[1];

      if (!arquivo) {
        document.getElementById('raw-data').textContent =
          "âŒ Nenhum arquivo informado.";
        return;
      }

      // Monta a rota correta para buscar os dados
      const resposta = await fetch(`/s3Route/dados/${arquivo}`);
      const data = await resposta.json();

      document.getElementById("raw-data").textContent =
        JSON.stringify(data, null, 2);

      if (isDados) return;

      if (!Array.isArray(data) || data.length === 0) return;

      const keys = Object.keys(data[0]);
      const labelKey = keys[0];
      const valueKey = keys[1];

      const labels = data.map(d => d[labelKey]);
      const values = data.map(d => Number(d[valueKey]) || 0);

      document.getElementById("charts").style.display = "block";

      new Chart(document.getElementById('chart1'), {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: valueKey,
            data: values
          }]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } }
        }
      });
    }

    carregarDados();
  </script>

</body>
</html>
